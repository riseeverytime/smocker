name: Use mocks to respond
version: "2"
testcases:
  - name: Don't register mocks
    steps:
      - type: http
        method: POST
        url: http://localhost:8081/reset
      - type: http
        method: GET
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 666

  - name: Use basic mock
    steps:
      - type: http
        method: POST
        url: http://localhost:8081/reset
      - type: http
        method: POST
        url: http://localhost:8081/mocks
        bodyFile: ../data/basic_mock.yml
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "Mocks registered successfully"
      - type: http
        method: GET
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test

  - name: Use basic mock list
    steps:
      - type: http
        method: POST
        url: http://localhost:8081/reset
      - type: http
        method: POST
        url: http://localhost:8081/mocks
        bodyFile: ../data/basic_mock_list.yml
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "Mocks registered successfully"
      - type: http
        method: GET
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test
      - type: http
        method: POST
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test2
      - type: http
        method: DELETE
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test3
      - type: http
        method: GET
        url: http://localhost:8080/test?foo=bar&foo=baz
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test4
      - type: http
        method: GET
        url: http://localhost:8080/test
        headers:
          X-Custom-Header: bar
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test5

  - name: Use matcher mock list
    steps:
      - type: http
        method: POST
        url: http://localhost:8081/reset
      - type: http
        method: POST
        url: http://localhost:8081/mocks
        bodyFile: ../data/matcher_mock_list.yml
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "Mocks registered successfully"
      - type: http
        method: GET
        url: http://localhost:8080/any
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test
      - type: http
        method: POST
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test2
      - type: http
        method: DELETE
        url: http://localhost:8080/test
        body: >
          {"id": 1}
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test3
      - type: http
        method: PUT
        url: http://localhost:8080/test
        headers:
          Content-Type: application/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test4
      - type: http
        method: PATCH
        url: http://localhost:8080/test?test=true
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual test5

  - name: Use dynamic mock list
    steps:
      - type: http
        method: POST
        url: http://localhost:8081/reset
      - type: http
        method: POST
        url: http://localhost:8081/mocks
        bodyFile: ../data/dynamic_mock_list.yml
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "Mocks registered successfully"
      - type: http
        method: GET
        url: http://localhost:8080/test
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "request path /test"
      - type: http
        method: GET
        url: http://localhost:8080/test2
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "request path /test2"
      - type: http
        method: GET
        url: http://localhost:8080/test3
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "request path /test3"
      - type: http
        method: GET
        url: http://localhost:8080/test4
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "request path /test4"
      - type: http
        method: GET
        url: http://localhost:8080/test5
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "request path /test5"
      - type: http
        method: GET
        url: http://localhost:8080/test6
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "request path /test6"

  - name: Use proxy mock list
    steps:
      - type: http
        method: POST
        url: http://localhost:8081/reset
      - type: http
        method: POST
        url: http://localhost:8081/mocks
        bodyFile: ../data/proxy_mock_list.yml
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.message ShouldEqual "Mocks registered successfully"
      - type: http
        method: GET
        url: http://localhost:8080/posts/1
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.id ShouldEqual 1
          - result.bodyjson.body ShouldNotBeBlank
          - result.bodyjson.title ShouldNotBeBlank
      - type: http
        method: GET
        url: http://localhost:8080/todos?userId=1
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.__len__ ShouldEqual 20
